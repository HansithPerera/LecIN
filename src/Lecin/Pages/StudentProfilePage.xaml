<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Lecin.Pages.StudentProfilePage"
             Title="Student Attendance Profile">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            
            <!-- Header -->
            <Label Text="ðŸ“Š Student Attendance Profile" 
                   FontSize="24" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   Margin="0,0,0,10"/>

            <!-- Student Selection Section (For Teachers) -->
            <Frame BackgroundColor="LightGray" 
                   Padding="15" 
                   CornerRadius="10"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="ðŸ” Select Student:" 
                           FontSize="16" 
                           FontAttributes="Bold"/>
                    
                    <Button Text="Load All Students" 
                            Command="{Binding LoadAllStudentsCommand}"
                            BackgroundColor="Blue"
                            TextColor="White"
                            CornerRadius="5"
                            Margin="0,5"/>
                    
                    <!-- Student Picker -->
                    <Picker x:Name="StudentPicker"
                            ItemsSource="{Binding AllStudents}"
                            SelectedItem="{Binding SelectedStudent}"
                            ItemDisplayBinding="{Binding Name}"
                            Title="Choose a student..."/>
                    
                    <!-- OR Manual Student ID Entry -->
                    <StackLayout Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                        <Entry x:Name="StudentIdEntry" 
                               Placeholder="Or enter Student ID directly..."
                               HorizontalOptions="FillAndExpand"/>
                        <Button Text="Load" 
                                Command="{Binding LoadAttendanceCommand}"
                                CommandParameter="{Binding Source={x:Reference StudentIdEntry}, Path=Text}"
                                BackgroundColor="Green"
                                TextColor="White"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsLoading}" 
                               IsRunning="{Binding IsLoading}"
                               Color="Blue"
                               HorizontalOptions="Center"/>

            <!-- Error Message -->
            <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                   BackgroundColor="Red" 
                   Padding="10" 
                   CornerRadius="5">
                <Label Text="{Binding ErrorMessage}" 
                       TextColor="White" 
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </Frame>

            <!-- Student Info Card -->
            <Frame IsVisible="{Binding SelectedStudent.StudentId, Converter={StaticResource StringToBoolConverter}}"
                   BackgroundColor="LightBlue" 
                   Padding="15" 
                   CornerRadius="10"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="ðŸ‘¤ Student Information:" FontSize="16" FontAttributes="Bold"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Label Grid.Row="0" Grid.Column="0" Text="Name:" FontAttributes="Bold"/>
                        <Label Grid.Row="0" Grid.Column="1" Text="{Binding SelectedStudent.Name}"/>
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="Student ID:" FontAttributes="Bold"/>
                        <Label Grid.Row="1" Grid.Column="1" Text="{Binding SelectedStudent.StudentId}"/>
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- Attendance Stats Card (Main Feature!) -->
            <Frame IsVisible="{Binding AttendanceStats.StudentId, Converter={StaticResource StringToBoolConverter}}"
                   BackgroundColor="White" 
                   Padding="20" 
                   CornerRadius="15"
                   HasShadow="True">
                <StackLayout Spacing="15">
                    
                    <Label Text="ðŸ“ˆ Overall Attendance" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>

                    <!-- Main Percentage Display -->
                    <StackLayout HorizontalOptions="Center" Spacing="5">
                        <Label Text="{Binding AttendanceStats.AttendancePercentageDisplay}" 
                               FontSize="48" 
                               FontAttributes="Bold" 
                               TextColor="{Binding AttendanceStats.StatusColor}"
                               HorizontalOptions="Center"/>
                        
                        <Label Text="{Binding AttendanceStats.AttendanceStatus}" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{Binding AttendanceStats.StatusColor}"
                               HorizontalOptions="Center"/>
                    </StackLayout>

                    <!-- Detailed Breakdown -->
                    <Grid Margin="0,15,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Frame Grid.Column="0" 
                               BackgroundColor="LightGreen" 
                               Padding="15" 
                               CornerRadius="10"
                               Margin="5">
                            <StackLayout HorizontalOptions="Center">
                                <Label Text="âœ… Attended" 
                                       FontAttributes="Bold" 
                                       HorizontalOptions="Center"/>
                                <Label Text="{Binding AttendanceStats.ClassesAttended}" 
                                       FontSize="28" 
                                       FontAttributes="Bold" 
                                       TextColor="DarkGreen"
                                       HorizontalOptions="Center"/>
                            </StackLayout>
                        </Frame>
                        
                        <Frame Grid.Column="1" 
                               BackgroundColor="LightBlue" 
                               Padding="15" 
                               CornerRadius="10"
                               Margin="5">
                            <StackLayout HorizontalOptions="Center">
                                <Label Text="ðŸ“š Total Classes" 
                                       FontAttributes="Bold" 
                                       HorizontalOptions="Center"/>
                                <Label Text="{Binding AttendanceStats.TotalClassesEnrolled}" 
                                       FontSize="28" 
                                       FontAttributes="Bold" 
                                       TextColor="DarkBlue"
                                       HorizontalOptions="Center"/>
                            </StackLayout>
                        </Frame>
                    </Grid>

                    <!-- Refresh Button -->
                    <Button Text="ðŸ”„ Refresh Attendance Data" 
                            Command="{Binding RefreshCommand}"
                            BackgroundColor="Purple"
                            TextColor="White"
                            CornerRadius="25"
                            Margin="0,10,0,0"/>
                    
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>

</ContentPage>